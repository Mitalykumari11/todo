{% extends 'base.html' %}
{% block body %}
<div class="w3-container w3-margin  w3-padding-16">


  <form class="w3-container w3-card w3-padding w3-margin-bottom w3-white" method="GET" autocomplete="off">
    <div class="w3-row-padding w3-padding-small">
      <div class="w3-col l2 m4 s12">
        <label class="w3-text-indigo"><b>Priority</b></label>
        <select class="w3-select w3-border w3-round w3-light-grey" style="height: 41px;" name="priority">
          <option value="" disabled selected>All</option>
          {% for p, color in [('Low','w3-green'), ('Medium','w3-orange'), ('High','w3-red')] %}
          <option value="{{p}}" {% if priority==p %}selected{% endif %} class="{{color}}">{{p}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="w3-col l2 m4 s12">
        <label class="w3-text-indigo"><b>Category</b></label>
        <select class="w3-select w3-border w3-round w3-light-grey" style="height: 41px;" name="category">
          <option value="" disabled selected>All</option>
          {% for c in ['Work','Personal','Other'] %}
          <option value="{{c}}" {% if category==c %}selected{% endif %}>{{c}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="w3-col l5 m8 s12">
        <label class="w3-text-indigo"><b>Search</b></label>
        <input type="search" name="title" placeholder="Search todos..." value="{{title}}"
          class="w3-input w3-border w3-round w3-light-grey">
      </div>
      <div class="w3-col l3 m12 s12 w3-center" style="padding-top:22px;">
        <button type="submit" class="w3-button w3-indigo w3-round w3-block w3-hover-deep-purple">
          <i class="fa fa-search"></i> Search
        </button>
      </div>

    </div>
  </form>

</div>

<div class="w3-container w3-margin-top">
  <table class="w3-table-all w3-card-4 w3-hoverable">
    <thead>
      <tr class="w3-indigo">
        <th>Category</th>
        <th>Priority</th>
        <th>Title</th>
        <th>Description</th>
        <th>Created At</th>
        <th>Due Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for item in todos %}
      <tr class="w3-hover-light-blue">

        <td>{{ item[1] }}</td>
        <td>
          {% if item[2] == "Low" %}
          <span class="w3-tag w3-green w3-round-small">Low</span>
          {% elif item[2] == "Medium" %}
          <span class="w3-tag w3-orange w3-round-small">Medium</span>
          {% elif item[2] == "High" %}
          <span class="w3-tag w3-red w3-round-small">High</span>
          {% else %}
          <span class="w3-tag w3-grey w3-round-small">{{ item[2] }}</span>
          {% endif %}
        </td>
        <td>{{ item[3] }}</td>
        <td>{{ item[4] }}</td>
        <td>{{ item[5].date() }}</td>
        {% if item[7] < today %} <td class="w3-text-red">{{ item[7] }}</td>
          {% elif item[7] == today %}
          <td class="w3-text-green">{{ item[7] }}</td>
          {% elif item[7] == tomorrow %}
          <td class="w3-text-blue">{{ item[7] }}</td>
          {% else %}
          <td>{{ item[7] }}</td>
          {% endif %}

          <td>
            <a href="/delete/{{ item[0] }}" class="w3-button w3-red w3-small w3-round-small w3-margin-right" onclick="return confirm('Are you sure you want to delete this item?');">Delete</a>
            <a href="/update/{{ item[0] }}" class="w3-button w3-blue w3-small w3-round-small">Update</a>
          </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

{% endblock body %}